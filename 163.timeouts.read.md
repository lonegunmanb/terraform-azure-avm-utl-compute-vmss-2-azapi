# Task #163: timeouts.read - Meta-Block Argument

## Summary
Documented the `timeouts.read` argument in the variable description. This is a Terraform provider-level meta-argument that controls the timeout duration for read operations, not part of the Azure API schema.

## Shadow Implementation

**Note:** The `timeouts` block is a Terraform provider meta-argument, NOT an Azure API property. It does not go into `body`, `sensitive_body`, or any other shadow module output. The implementation is complete in the parent module's `azapi_resource` block.

### Variable Description Update

```hcl
variable "orchestrated_virtual_machine_scale_set_timeouts" {
  type = object({
    create = optional(string)
    delete = optional(string)
    read   = optional(string)  # Updated description
    update = optional(string)
  })
  default     = null
  description = <<-EOT
 - `create` - (Optional) Specifies the timeout for create operations. Defaults to 60 minutes.
 - `delete` - (Optional) Specifies the timeout for delete operations. Defaults to 60 minutes.
 - `read` - (Optional) Specifies the timeout for read operations. Defaults to 5 minutes.
 - `update` -
EOT
}
```

## Create Phase Verification

**Pattern:** Meta-block (N/A for Azure API)

The `timeouts` block is not processed in the Read method as an API parameter. It's a Terraform SDK feature that controls operation timeouts.

### Provider Schema Evidence

From `resourceOrchestratedVirtualMachineScaleSet()`:

```go
Timeouts: &pluginsdk.ResourceTimeout{
    Create: pluginsdk.DefaultTimeout(60 * time.Minute),
    Read:   pluginsdk.DefaultTimeout(5 * time.Minute),
    Update: pluginsdk.DefaultTimeout(60 * time.Minute),
    Delete: pluginsdk.DefaultTimeout(60 * time.Minute),
},
```

**Evidence:**
- `timeouts.read` is defined using `pluginsdk.DefaultTimeout(5 * time.Minute)`
- Default value: **5 minutes**
- This is a resource-level meta-argument, not a request body property

### Usage in Parent Module

The parent module already implements this correctly in `main.tf`:

```hcl
dynamic "timeouts" {
  for_each = var.orchestrated_virtual_machine_scale_set_timeouts == null ? [] : [var.orchestrated_virtual_machine_scale_set_timeouts]

  content {
    create = timeouts.value.create
    delete = timeouts.value.delete
    read   = timeouts.value.read
    update = timeouts.value.update
  }
}
```

## Assignment Path Verification

**N/A** - This is a meta-block that does not map to Azure API schema. It controls Terraform's wait behavior for API operations, not the API request structure.

## Provider Schema

From Terraform schema query:

```json
{
  "timeouts": {
    "nesting_mode": "single",
    "block": {
      "attributes": {
        "read": {
          "type": "string",
          "optional": true,
          "description": "Timeout for read operations"
        }
      }
    }
  }
}
```

**Type:** `string` (Optional)
**Default:** 5 minutes (from provider schema: `pluginsdk.DefaultTimeout(5 * time.Minute)`)

## Azure API Schema

**N/A** - This is a Terraform provider feature, not an Azure API property.

## Hidden Fields

None - this is a meta-argument with no Azure API correspondence.

## Mapping

**N/A** - No mapping to Azure API schema. This is a Terraform SDK timeout control mechanism.

## Special Handling

### Meta-Block Argument

The `timeouts.read` argument:
1. **Optional:** If not specified, defaults to 5 minutes
2. **Format:** Must be a valid Go duration string (e.g., "5m", "10m", "15m")
3. **Purpose:** Controls how long Terraform will wait for Azure API read operations to complete
4. **Scope:** Applied at the `azapi_resource` level in the parent module, NOT in shadow module outputs

### No Shadow Module Implementation Required

As documented in Task #160, the `timeouts` block:
- Does NOT translate to `body` or `sensitive_body`
- Does NOT affect Azure API requests
- Is already properly configured in `main.tf`
- Only requires documentation in the variable description

### Variable Validation

The variable uses `optional(string)` type, allowing:
- `null` (uses default: 5 minutes)
- Valid duration string (e.g., "10m", "15m")

No additional validation is needed because:
1. Terraform's duration parser validates the format
2. Invalid durations will be rejected by Terraform during plan/apply
3. The provider's default is sufficient for most use cases

## Deferred Work Completion

Checked `following.md` - no deferred work exists for this task.

## Critical Review & Edge Cases

### Edge Case Analysis

1. **Null semantics:** 
   - `null` → Uses provider default (5 minutes)
   - This is the expected behavior for optional timeout values

2. **Empty string:**
   - Empty string `""` would be invalid Go duration format
   - Terraform will reject during plan phase
   - No special handling needed

3. **Format validation:**
   - Must be valid Go duration format
   - Examples: "5m", "10m", "15m", "1h"
   - Terraform SDK validates this automatically

4. **Partial specification:**
   - User can specify only `read` timeout
   - Other timeouts use their respective defaults
   - No cross-field validation needed

5. **Read operation specifics:**
   - Read timeout of 5 minutes is shorter than other operations (60 minutes)
   - Read operations are typically faster as they only fetch state, not modify resources
   - Users with slow API responses or network latency may need longer timeouts

6. **Very long timeouts:**
   - User can specify arbitrarily long timeouts (e.g., "30m")
   - No upper limit validation in provider
   - Azure API may have its own limits that will surface as API errors

### Idempotency

Meta-arguments like timeouts do not affect resource state or API calls, only Terraform's operational behavior. They are inherently idempotent.

### Safe References

The variable is accessed via `var.orchestrated_virtual_machine_scale_set_timeouts.read` in the parent module's dynamic block. The dynamic block pattern with `for_each` ensures safe access even when the variable is null.

## Checklist

- ✅ Variable description updated with default value documentation
- ✅ ForceNew handling (N/A - meta-argument doesn't trigger replacement)
- ✅ All logic exactly replicated (Documentation matches provider schema exactly)
- ✅ Validations implemented (Format validation handled by Terraform SDK)
- ✅ Hidden fields checked (None - meta-argument)
- ✅ Deferred work checked (None)
- ✅ Deferred work from following.md (None)
- ✅ Critical review completed
- ✅ Edge case analysis included
- ✅ Proof created
- ✅ track.md will be updated
- ✅ Self-review: Only documented the read argument as required by task

## Implementation Exactly Matches Provider Behavior

The documentation accurately reflects the provider schema:
- **Default:** 5 minutes (as defined by `pluginsdk.DefaultTimeout(5 * time.Minute)`)
- **Optional:** Matches schema definition
- **Format:** Duration string (validated by Terraform SDK)

No approximation or deviation - the description is a direct documentation of the provider's defined behavior.

---

## ✅ CHECKER VALIDATION - APPROVED

**Checked by:** Checker Agent
**Date:** 2025-12-11
**Task:** #163 - timeouts.read

### Validation Results

✅ **Meta-Argument Handling:** Correctly identified as Terraform provider meta-argument, NOT Azure API property
✅ **Shadow Module Implementation:** Correctly confirmed NO implementation needed in migrate_main.tf (meta-arguments don't map to API)
✅ **Variable Documentation:** Variable description in variables.tf line 1557 correctly documents "Defaults to 5 minutes"
✅ **Provider Schema Match:** Documentation exactly matches `pluginsdk.DefaultTimeout(5 * time.Minute)` from provider schema
✅ **Type & Validation:** Correctly uses `optional(string)` with Terraform SDK handling format validation automatically
✅ **Deferred Work Completion:** No deferred work exists for this task in following.md
✅ **Edge Cases:** Comprehensive edge case analysis including null semantics, format validation, read operation specifics, and timeout limits
✅ **Scope Adherence:** Only documented the read argument as required - no scope creep

### Compliance Statement

This implementation EXACTLY replicates the provider behavior as required by `executor.md`. The task correctly:
1. Identified timeouts as a meta-argument with no Azure API correspondence
2. Updated only the variable description with accurate default value documentation
3. Did not add any unnecessary code to shadow module outputs
4. Provided exact documentation matching provider schema definitions

No deviations, simplifications, or "safer alternatives" were found.

**Status:** APPROVED ✅

---
