# Task #163: timeouts.read Argument

## Summary
Updated the `read` timeout field in the `timeouts` variable to include the default value of `"5m"` (5 minutes) from the provider schema. The `timeouts` block is a Terraform provider meta-argument that controls operation timeout durations, NOT an Azure API property.

## Implementation

### Shadow Module Code

**Note:** The `timeouts` block is a Terraform provider meta-argument, not an Azure API property. It does NOT go into the `body`, `sensitive_body`, or any other shadow module output. According to the guidance in `timeouts.md`, no code changes are required in the shadow module's `migrate_*` files.

```hcl
# NO CODE CHANGES REQUIRED IN SHADOW MODULE
# The timeouts.read field is handled directly in the parent module's azapi_resource:
# resource "azapi_resource" "this" {
#   timeouts {
#     read = var.timeouts != null ? var.timeouts.read : null  # <- Default "5m" applied via variable
#   }
# }
```

### Variables Update

Updated `variables.tf` to add the default value for `read` timeout:

```hcl
variable "timeouts" {
  type = object({
    create = optional(string, "60m")
    delete = optional(string, "60m")
    read   = optional(string, "5m")  # <- Added default from provider
    update = optional(string)
  })
  default     = null
  description = <<-EOT
 - `create` - (Optional) Specifies the timeout for create operations. Defaults to 60 minutes.
 - `delete` - (Optional) Specifies the timeout for delete operations. Defaults to 60 minutes.
 - `read` - (Optional) Specifies the timeout for read operations. Defaults to 5 minutes.  # <- Description already correct
 - `update` - (Optional) Specifies the timeout for update operations. Defaults to 60 minutes.
EOT
}
```

## Create Phase Verification

**Pattern:** Meta-argument (N/A for Azure API - not part of request body)

From `resourceOrchestratedVirtualMachineScaleSet()` in provider source code:

```go
Timeouts: &pluginsdk.ResourceTimeout{
    Create: pluginsdk.DefaultTimeout(60 * time.Minute),
    Read:   pluginsdk.DefaultTimeout(5 * time.Minute),  // <- 5 minutes
    Update: pluginsdk.DefaultTimeout(60 * time.Minute),
    Delete: pluginsdk.DefaultTimeout(60 * time.Minute),
},
```

**Evidence:**
- Default value for `Read` timeout: **5 minutes**
- This is a resource-level meta-argument that controls how long Terraform waits for read operations
- NOT part of the Azure REST API request/response schema

**Decision:** No shadow module implementation. Updated variable default value only.

## Assignment Path Verification

**N/A** - The `timeouts` block is not assigned to any Azure API property path. It's a Terraform provider-level feature that controls operation timeout behavior.

## Provider Schema

From `query_terraform_block_implementation_source_code(entrypoint_name="schema")`:

```go
Timeouts: &pluginsdk.ResourceTimeout{
    Create: pluginsdk.DefaultTimeout(60 * time.Minute),
    Read:   pluginsdk.DefaultTimeout(5 * time.Minute),
    Update: pluginsdk.DefaultTimeout(60 * time.Minute),
    Delete: pluginsdk.DefaultTimeout(60 * time.Minute),
},
```

**Type:** Meta-argument (not a body property)
**Default Value:** `5 * time.Minute` → `"5m"` in Terraform string format
**Optional:** Yes
**Required:** No

From Terraform schema query:
```json
"timeouts": {
  "nesting_mode": "single",
  "block": {
    "attributes": {
      "read": {"type": "string", "optional": true}
    }
  }
}
```

## Azure API Schema

**N/A** - The `timeouts` block has no Azure API correspondence. It's purely a Terraform provider construct for controlling operation timeouts.

## Hidden Fields

None - this is a meta-argument with no Azure API mapping.

## Mapping

**N/A** - No Azure API property mapping exists for this meta-argument.

## Special Handling

### Timeout Meta-Argument Pattern

**Critical Understanding:**

1. **Not an API Property:** The `timeouts` block controls Terraform's behavior when waiting for Azure API operations to complete, NOT the API request/response data.

2. **Variable Default:** The default value is applied via the `optional(string, "5m")` syntax in the variable definition, which means:
   - If user provides `timeouts = { read = "10m" }`, use `"10m"`
   - If user provides `timeouts = {}`, use `"5m"` (the default)
   - If user provides `timeouts = null`, use `"5m"` (the default)

3. **Parent Module Responsibility:** The parent module that instantiates this shadow module will pass the timeouts variable directly to its `azapi_resource` block:
   ```hcl
   resource "azapi_resource" "this" {
     # ... other fields ...
     
     timeouts {
       create = var.timeouts != null ? var.timeouts.create : null
       delete = var.timeouts != null ? var.timeouts.delete : null
       read   = var.timeouts != null ? var.timeouts.read : null  # <- Default "5m" from variable
       update = var.timeouts != null ? var.timeouts.update : null
     }
   }
   ```

4. **No Shadow Module Output:** Unlike other fields that go into `body`, `sensitive_body`, or `azapi_header`, timeouts are NOT part of any shadow module output.

### Default Value Format

- **Provider Format:** `5 * time.Minute` (Go duration)
- **Terraform Format:** `"5m"` (string duration format)
- **Conversion:** Direct translation from Go time.Duration constants

## Deferred Work Completion

No deferred work was recorded in `following.md` for this task.

## Critical Review & Edge Case

### Null Semantics

- **When `timeouts = null`:** Terraform uses the variable's default values for each operation (read defaults to `"5m"`)
- **When `timeouts = {}`:** Same as null - defaults are applied via `optional()` syntax
- **When `timeouts = { read = null }`:** The `null` value is NOT valid; Terraform would use the default `"5m"` from `optional()`
- **When `timeouts = { read = "10m" }`:** User-specified value overrides the default

### Boundary Conditions

1. **Minimum Value:** Terraform doesn't enforce a minimum timeout value, but extremely short values (e.g., `"1s"`) would likely cause operations to fail
2. **Maximum Value:** No enforced maximum, but Azure API operations have their own service-side timeouts
3. **Invalid Format:** Terraform validates duration format (must be valid Go duration string like `"5m"`, `"1h30m"`)

### Idempotency

- Timeouts don't affect resource state or API calls
- Changing timeout values doesn't trigger resource replacement or updates
- Timeouts only affect how long Terraform waits for operations to complete

### Safe References

**N/A** - No nested access required for this meta-argument.

### Edge Case Analysis

1. **Empty String:** Not valid - Terraform expects valid duration format or null
2. **Zero Value:** `"0s"` would cause immediate timeout and operation failure
3. **Very Large Values:** `"999h"` is valid but impractical; operations will complete or fail long before timeout
4. **Format Variations:** Terraform accepts various duration formats: `"5m"`, `"300s"`, `"0.083333h"` all represent 5 minutes

## Checklist

- ✅ Property in correct location (N/A - meta-argument, not a body property)
- ✅ ForceNew handling (N/A - timeout changes don't trigger resource replacement)
- ✅ All logic exactly replicated (Default value from provider schema: 5 minutes)
- ✅ Validations implemented (Type validation via `optional(string, "5m")`)
- ✅ TODO comment added (N/A - not a sensitive field migration)
- ✅ Hidden fields checked (None - meta-argument)
- ✅ Deferred work recorded (N/A)
- ✅ Deferred work completed (None to complete)
- ✅ Critical review completed
- ✅ Edge case analysis included
- ✅ Proof created
- ✅ track.md will be updated
- ✅ Self-review: Only updated the `read` timeout default value as required by Task #163

## Implementation Verification

**What changed:**
1. Added default value `"5m"` to the `read` field in `timeouts` variable (line 1550 of variables.tf)
2. Variable description already correctly stated "Defaults to 5 minutes" (no change needed)

**What did NOT change:**
- No changes to shadow module files (`migrate_main.tf`, `migrate_outputs.tf`, `migrate_validation.tf`, `migrate_variables.tf`)
- No changes to other timeout fields (`create`, `delete`, `update`)
- No changes to any other variables or files

**Compliance with executor.md:**
- ✅ Followed special instructions in `timeouts.md` for timeout meta-argument handling
- ✅ Only modified the owning variable in `variables.tf`
- ✅ Replicated exact default value from provider schema (5 minutes)
- ✅ Did not add any code to shadow module (correct for meta-arguments)
- ✅ Did not modify unrelated fields or tasks

**Compliance with timeouts.md guidance:**
- ✅ Queried provider source code for timeout defaults
- ✅ Updated variable default value with correct timeout string
- ✅ Variable description already correct (verified)
- ✅ Documented provider schema evidence in proof
- ✅ Confirmed no shadow module changes needed

---

## ✅ CHECKER VALIDATION - APPROVED

**Checked by:** Checker Agent
**Date:** 2025-12-12
**Task:** #163 - timeouts.read

### Validation Results

✅ **Meta-Argument Handling:** Correctly identified as Terraform provider meta-argument requiring no shadow module implementation
✅ **Default Value:** Exact replication of provider default (`5 * time.Minute` = `"5m"`)
✅ **Method Priority:** Used PREFER method `optional(string, "5m")` syntax for default value
✅ **Variable Update:** Correctly modified only the `read` field in `variables.tf` line 1550
✅ **Description:** Variable description already correctly stated "Defaults to 5 minutes"
✅ **Shadow Module:** Correctly made NO changes to `migrate_*` files (per timeouts.md rules)
✅ **Provider Evidence:** Proof document contains correct Go code showing `DefaultTimeout(5 * time.Minute)`
✅ **Deferred Work Completion:** No deferred work for this task in following.md
✅ **Deferred Work Recording:** No deferrals made by this task
✅ **Scope Compliance:** Only modified the specific field required by Task #163, no unrelated changes
✅ **Edge Cases:** Properly analyzed null semantics, boundary conditions, and validation

### Compliance Statement

This implementation EXACTLY replicates the provider behavior as required by `executor.md` and follows the specialized guidance in `timeouts.md` for meta-argument handling. The executor correctly:

1. Identified `timeouts.read` as a Terraform meta-argument, not an Azure API property
2. Extracted the exact default value from provider schema: `5 * time.Minute` → `"5m"`
3. Applied the default using the preferred `optional(string, "5m")` syntax
4. Updated only the required variable field in `variables.tf`
5. Made no unnecessary changes to shadow module files (correct per timeouts.md)
6. Created a complete proof document with proper provider evidence

No deviations, simplifications, or "safer alternatives" were found. The implementation is precise and minimal.

**Status:** APPROVED ✅

---
