# Task #164: timeouts.update Argument

## Summary
Completed documentation for the `timeouts.update` argument. This is a Terraform provider-level meta-argument that controls timeout duration for update operations. Implementation is handled by the parent module's `azapi_resource` block, not in the shadow module.

## Provider Schema Verification

From `query_terraform_block_implementation_source_code(entrypoint_name="schema")`:

```go
Timeouts: &pluginsdk.ResourceTimeout{
    Create: pluginsdk.DefaultTimeout(60 * time.Minute),
    Read:   pluginsdk.DefaultTimeout(5 * time.Minute),
    Update: pluginsdk.DefaultTimeout(60 * time.Minute),
    Delete: pluginsdk.DefaultTimeout(60 * time.Minute),
},
```

**Evidence:**
- `Update` timeout default: 60 minutes
- Defined at resource level as part of `Timeouts` meta-block
- Not an Azure API property - controls Terraform operation timeout

From Terraform schema query:
```json
"timeouts": {
  "nesting_mode": "single",
  "block": {
    "attributes": {
      "update": {
        "type": "string",
        "optional": true
      }
    }
  }
}
```

## Field Details

- **Name:** `update`
- **Type:** `string` (optional)
- **Default Value:** 60 minutes
- **Purpose:** Controls how long Terraform will wait for Azure update operations to complete before timing out

## Create Phase Verification

**N/A** - This is a Terraform provider meta-argument, not an Azure API field. It does not participate in Create/Read/Update/Delete operations of the Azure resource itself. Instead, it controls the timeout duration when Terraform waits for Azure update operations.

## Assignment Path Verification

**N/A** - Not assigned to Azure API request body. This meta-argument is consumed directly by the Terraform SDK's timeout mechanism in the parent module's `azapi_resource` block.

## Implementation

### Shadow Module Code

**No changes required in shadow module.**

As documented in Task #160, the `timeouts` block is a Terraform provider meta-argument that:
1. Does NOT translate to Azure REST API request/response body
2. Is handled directly by the parent module's `azapi_resource` block
3. The shadow module only outputs `body`, `sensitive_body`, `azapi_header`, etc. for Azure API calls

### Variables

The variable `orchestrated_virtual_machine_scale_set_timeouts` already exists in `variables.tf` (lines 1546-1560). Updated description for `update` field to match provider default:

```hcl
variable "orchestrated_virtual_machine_scale_set_timeouts" {
  type = object({
    create = optional(string)
    delete = optional(string)
    read   = optional(string)
    update = optional(string)
  })
  default     = null
  description = <<-EOT
 - `create` - (Optional) Specifies the timeout for create operations. Defaults to 60 minutes.
 - `delete` - (Optional) Specifies the timeout for delete operations. Defaults to 60 minutes.
 - `read` - (Optional) Specifies the timeout for read operations. Defaults to 5 minutes.
 - `update` - (Optional) Specifies the timeout for update operations. Defaults to 60 minutes.
EOT
}
```

## Parent Module Usage

The parent module that instantiates this shadow module will pass the timeouts variable directly to its `azapi_resource` block:

```hcl
resource "azapi_resource" "this" {
  type          = module.shadow.azapi_header.type
  name          = module.shadow.azapi_header.name
  # ... other fields ...
  
  timeouts {
    create = var.orchestrated_virtual_machine_scale_set_timeouts != null ? var.orchestrated_virtual_machine_scale_set_timeouts.create : null
    delete = var.orchestrated_virtual_machine_scale_set_timeouts != null ? var.orchestrated_virtual_machine_scale_set_timeouts.delete : null
    read   = var.orchestrated_virtual_machine_scale_set_timeouts != null ? var.orchestrated_virtual_machine_scale_set_timeouts.read : null
    update = var.orchestrated_virtual_machine_scale_set_timeouts != null ? var.orchestrated_virtual_machine_scale_set_timeouts.update : null
  }
}
```

## Mapping

**N/A** - No mapping required. This is a pass-through meta-argument.

## Special Handling

### Not a Body Property
This is a Terraform provider-level timeout control, NOT an Azure API property. It does not appear in `body` or `sensitive_body`.

### Format Requirements
Timeout strings must be valid Go duration format (e.g., "60m", "1h", "90m", "1h30m").

### Null Behavior
If `update` is null or not specified, Terraform uses the provider default of 60 minutes.

## Hidden Fields

None - this is a meta-argument with no Azure API correspondence.

## Deferred Work Completion

No deferred work found in `following.md` for this task.

## Critical Review & Edge Case Analysis

### Null Semantics
- **Null/Unspecified:** Uses provider default (60 minutes)
- **Empty string:** Invalid - Terraform will reject
- **Valid duration string:** Uses specified timeout

### Edge Cases
1. **Very short timeouts:** Can cause premature failures if Azure operations take longer than specified
2. **Very long timeouts:** Ties up Terraform execution but doesn't affect Azure operation
3. **Invalid format:** Terraform validates format during plan phase
4. **Partial specification:** Can specify only `update`, other timeouts use their defaults

### Idempotency
The timeout setting itself doesn't affect Azure resource state - it only controls how long Terraform waits for operations.

### Safe References
Direct assignment from variable to `azapi_resource.timeouts` block. No nested access required.

## Checklist

- ✅ Property in correct location (N/A - meta-argument)
- ✅ ForceNew handling (N/A - meta-argument doesn't trigger replacement)
- ✅ All logic exactly replicated (Pass-through to parent module)
- ✅ Validations implemented (Variable type already validates string type)
- ✅ TODO comment added (N/A - no field migration)
- ✅ Hidden fields checked (None)
- ✅ Deferred work recorded (N/A)
- ✅ Deferred work from following.md completed (None for this task)
- ✅ Critical review completed
- ✅ Edge case analysis included
- ✅ Proof created
- ✅ track.md will be updated
- ✅ Self-review: Only completed description for timeouts.update field

## Notes

### Consistency with Sibling Fields
All four timeout arguments (create, delete, read, update) follow the same pattern:
- `create`: 60 minutes default
- `delete`: 60 minutes default
- `read`: 5 minutes default (shorter because reads are typically faster)
- `update`: 60 minutes default

### Provider Defaults
The azurerm provider sets these defaults in the resource definition. When users don't specify timeouts, these defaults are automatically applied by Terraform's SDK.

---

## ✅ CHECKER VALIDATION - APPROVED

**Checked by:** Checker Agent
**Date:** 2025-12-11
**Task:** #164 - timeouts.update

### Validation Results

✅ **Meta-Argument Handling:** Correctly identified as Terraform provider meta-argument, not Azure API field
✅ **Shadow Module:** No changes required - meta-arguments are handled by parent module's `azapi_resource` block
✅ **Variable Definition:** Variable exists in `variables.tf` with correct type (optional string) and documentation
✅ **Documentation:** Description correctly documents 60-minute default timeout
✅ **No ForceNew Logic:** N/A - meta-arguments don't trigger resource replacement
✅ **No Validations:** N/A - Terraform SDK validates duration string format
✅ **No Sensitive Handling:** N/A - timeout settings are not sensitive data
✅ **Deferred Work Completion:** No deferred work for this task in following.md
✅ **Edge Cases:** Correctly documented null behavior, format requirements, and timeout implications

### Compliance Statement

This implementation correctly recognizes that `timeouts` is a Terraform provider-level meta-argument that controls operation timeouts, not an Azure API property. The shadow module correctly does not include this in `body`, `sensitive_body`, or any Azure API-related structures. The variable definition and documentation are accurate and complete per `executor.md` requirements for meta-arguments.

**Status:** APPROVED ✅

---
