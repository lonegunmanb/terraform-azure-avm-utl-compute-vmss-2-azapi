# Task #161: timeouts.create - Timeout Default Implementation

## Summary
Updated the `create` timeout field default value to "60m" based on provider schema. This is a Terraform provider meta-argument that controls operation timeout duration, not an Azure API property.

## Shadow Module Code

**No shadow module implementation required.** The `timeouts` block is a Terraform provider meta-argument handled directly by the parent module's `azapi_resource` block, not in shadow module locals.

```hcl
# NO CHANGES to migrate_main.tf, migrate_variables.tf, migrate_outputs.tf, migrate_validation.tf
# 
# The parent module will use the timeout like this:
# resource "azapi_resource" "this" {
#   # ... other fields ...
#   
#   timeouts {
#     create = var.timeouts != null ? var.timeouts.create : null  # <- Uses default "60m" from variable
#     delete = var.timeouts != null ? var.timeouts.delete : null
#     read   = var.timeouts != null ? var.timeouts.read : null
#     update = var.timeouts != null ? var.timeouts.update : null
#   }
# }
```

## Create Phase Verification

**Pattern:** Meta-argument (Terraform provider-level, not Azure API)

From `resourceOrchestratedVirtualMachineScaleSet()`:

```go
Timeouts: &pluginsdk.ResourceTimeout{
    Create: pluginsdk.DefaultTimeout(60 * time.Minute),
    Read:   pluginsdk.DefaultTimeout(5 * time.Minute),
    Update: pluginsdk.DefaultTimeout(60 * time.Minute),
    Delete: pluginsdk.DefaultTimeout(60 * time.Minute),
},
```

**Evidence:**
- Default value for `Create`: **60 minutes** (`60 * time.Minute`)
- This is a resource-level meta-argument controlling how long Terraform waits for Azure API operations
- Not part of Azure API request body

**Decision:** No shadow module implementation needed. Updated variable default value in `variables.tf`.

## Assignment Path Verification

**N/A** - The `timeouts` block is not part of the Azure API request/response body. It's a Terraform provider construct that controls operation timeout behavior.

## Provider Schema

From `resourceOrchestratedVirtualMachineScaleSet()`:

```go
Timeouts: &pluginsdk.ResourceTimeout{
    Create: pluginsdk.DefaultTimeout(60 * time.Minute),
    Read:   pluginsdk.DefaultTimeout(5 * time.Minute),
    Update: pluginsdk.DefaultTimeout(60 * time.Minute),
    Delete: pluginsdk.DefaultTimeout(60 * time.Minute),
},
```

**Schema Details:**
- Type: `string` (duration format)
- Optional: Yes
- Default: `60 * time.Minute` (converted to "60m" in Terraform)

## Azure API Schema

**N/A** - The `timeouts` block does not correspond to any Azure API field. It's purely a Terraform provider feature.

## Hidden Fields

**None** - Meta-argument with no Azure API correspondence.

## Mapping

**Terraform Variable → Provider Behavior:**
- `var.timeouts.create` (string like "60m", "1h", "90m") → Controls Terraform's wait duration for Create operations
- If not specified, uses default from provider: **60 minutes**

## Special Handling

### Variable Default Implementation

**Updated in `variables.tf`:**

```hcl
variable "timeouts" {
  type = object({
    create = optional(string, "60m")  # <- Added default value
    delete = optional(string)
    read   = optional(string)
    update = optional(string)
  })
  default     = null
  description = <<-EOT
 - `create` - (Optional) Specifies the timeout for create operations. Defaults to 60 minutes.
 - `delete` - (Optional) Specifies the timeout for delete operations. Defaults to 60 minutes.
 - `read` - (Optional) Specifies the timeout for read operations. Defaults to 5 minutes.
 - `update` - (Optional) Specifies the timeout for update operations. Defaults to 60 minutes.
EOT
}
```

**Implementation:**
- Used `optional(string, "60m")` to set default value
- Converted Go duration `60 * time.Minute` to Terraform duration string `"60m"`
- Variable description already correctly states "Defaults to 60 minutes"

### Why No Shadow Module Implementation

1. **Meta-Argument Nature:** `timeouts` is a Terraform SDK feature, not Azure API data
2. **Shadow Module Scope:** Shadow modules transform Terraform config → Azure API request body
3. **Timeout Location:** Timeouts control Terraform's behavior while waiting for API operations
4. **Parent Module Responsibility:** The `azapi_resource` block in parent module consumes the timeout variable directly
5. **No API Correspondence:** There is no `timeouts` field in Azure REST API schema

## Deferred Work Completion

**Checked `following.md`:** No deferred work found for Task #161.

## Critical Review & Edge Case Analysis

### Edge Cases

1. **Null timeout:** If `var.timeouts` is null or `var.timeouts.create` is not specified, Terraform uses the default "60m"
2. **Empty string:** Not valid - Terraform requires proper duration format (e.g., "60m", "1h")
3. **Invalid format:** Terraform will validate duration string format at plan time
4. **Zero duration:** Not practical - operations need time to complete
5. **Extremely large duration:** Technically allowed but not recommended

### Null Semantics

- `var.timeouts = null` → All operations use provider defaults (Create=60m)
- `var.timeouts = {}` → `create` field uses default "60m" from `optional()` type
- `var.timeouts = { create = null }` → Uses default "60m" (same as not specifying)
- `var.timeouts = { create = "90m" }` → Uses explicit value "90m"

### Idempotency

✅ **Fully idempotent** - Timeout values don't affect Azure resource state, only Terraform operation behavior

### Safe References

✅ **No nested access needed** - Simple optional field with default value

### Boundary Conditions

- **Minimum:** No explicit minimum in provider, but operations need time to complete
- **Maximum:** No explicit maximum, but extremely long timeouts not recommended
- **Format:** Must be valid Go duration string (e.g., "60m", "1h", "1h30m")

## Checklist

- ✅ Property in correct location (N/A - meta-argument, not in body)
- ✅ ForceNew handling (N/A - timeout changes don't trigger replacement)
- ✅ All logic exactly replicated (Default value "60m" matches provider's `60 * time.Minute`)
- ✅ Validations implemented (N/A - Terraform validates duration string format)
- ✅ Hidden fields checked (None)
- ✅ Deferred work recorded (N/A - no deferral needed)
- ✅ Deferred work from following.md (None found)
- ✅ Critical review completed
- ✅ Edge case analysis included
- ✅ Proof created
- ✅ track.md will be updated to Pending for check
- ✅ Self-review: Only updated `create` timeout default, no inappropriate additions

## Implementation Summary

**Changed File:** `variables.tf` (line 1548)

**Change Made:**
```hcl
# Before:
create = optional(string)

# After:
create = optional(string, "60m")
```

**Rationale:**
- Extracted default value from provider source: `pluginsdk.DefaultTimeout(60 * time.Minute)`
- Converted to Terraform duration string: `"60m"`
- Applied using `optional()` type's default value feature
- No shadow module changes needed - timeouts are meta-arguments handled by parent module

**Provider Evidence:**
```go
Timeouts: &pluginsdk.ResourceTimeout{
    Create: pluginsdk.DefaultTimeout(60 * time.Minute), // <- Source of "60m" default
    Read:   pluginsdk.DefaultTimeout(5 * time.Minute),
    Update: pluginsdk.DefaultTimeout(60 * time.Minute),
    Delete: pluginsdk.DefaultTimeout(60 * time.Minute),
},
```

This implementation exactly replicates the provider's default behavior for the `create` timeout operation.

---

## ✅ CHECKER VALIDATION - APPROVED

**Checked by:** Checker Agent
**Date:** 2025-12-12
**Task:** #161 - timeouts.create

### Validation Results

✅ **Timeouts Special Rules:** Executor correctly read and followed `timeouts.md` override document
✅ **Meta-Argument Understanding:** Correctly identified as Terraform provider meta-argument, not Azure API property
✅ **Variable Default:** Correctly implemented `optional(string, "60m")` in variables.tf line 1548
✅ **Provider Evidence:** Extracted correct default from `pluginsdk.DefaultTimeout(60 * time.Minute)` → `"60m"`
✅ **Shadow Module:** Correctly determined no shadow module changes needed (meta-argument handled by parent module)
✅ **Description Accuracy:** Variable description correctly states "Defaults to 60 minutes"
✅ **Deferred Work Completion:** No deferred work for this task in following.md
✅ **Deferred Work Recording:** No deferrals made (N/A for timeout meta-arguments)
✅ **Edge Cases:** Properly analyzed null semantics, invalid formats, boundary conditions
✅ **Proof Document:** Complete with provider schema evidence, no forbidden phrases

### Compliance Statement

This implementation EXACTLY replicates the provider behavior as required by `executor.md` and `timeouts.md`. The executor correctly:
1. Identified timeouts as meta-arguments requiring special handling per timeouts.md
2. Extracted the default value from provider source code (60 minutes)
3. Applied the default using `optional(string, "60m")` syntax per executor.md line 148
4. Avoided inappropriate shadow module changes (timeouts consumed by parent module's azapi_resource)
5. Provided complete evidence and edge case analysis

No deviations, simplifications, or "safer alternatives" were found.

**Status:** APPROVED ✅

---
