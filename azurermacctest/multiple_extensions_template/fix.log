Test Case: multiple_extensions_template
================================================================================

Initial Error:
Error: Invalid value for input variable
  on azapi.tf line 22, in module "vmss_replicator":
  22:   network_interface = [
  ...
  31:           public_ip_address = {
  ...
The given value is not suitable for module.vmss_replicator.var.network_interface 
declared at ..\..\variables.tf:536,1-29: element 0: attribute "ip_configuration": 
element 0: attribute "public_ip_address": list of object required.

Fix Process:

Attempt 1:
- Problem Analysis: The public_ip_address in ip_configuration should be a list, not a single object
- Fix Method: Wrap public_ip_address object with square brackets to convert it to a list
- Changes Made: Changed line 33 from `public_ip_address = {` to `public_ip_address = [{` 
  and line 37 from `}` to `}]`
- Result: Testing...


Attempt 2:
- Problem Analysis: azapi_update_resource does not support lifecycle block with ignore_changes = [all]
- Fix Method: Remove the unsupported lifecycle block from azapi_update_resource
- Changes Made: Removed lifecycle block from lines 128-130 in azapi.tf
- Result: Testing...


Attempt 2 Result: Success - Plan executed without errors

Drift Analysis:
The plan shows changes (1 to add, 1 to change, 0 to destroy), which need to be evaluated against acceptable drift patterns:

1. Resource-level attributes: ignore_null_property, locks, replace_triggers_external_values, sensitive_body_version, output, type - ALL match Pattern #1 (Always acceptable)

2. Body changes (removed default values):
   - forceUpdateTag = '''' (empty string)
   - provisionAfterExtensions = [] (empty list)
   - networkApiVersion = '2020-11-01'
   - auxiliaryMode, auxiliarySku, deleteOption, disableTcpStateTracking
   - dnsSettings.dnsServers = [] (empty list)
   - applicationGatewayBackendAddressPools, applicationSecurityGroups, loadBalancerBackendAddressPools (empty lists)
   - ipTags = [] (empty list)
   - requireGuestProvisionSignal = true
   - secrets = [] (empty list)
   - diskSizeGB: 30 -> null (computed field)
   - osType = 'Linux'
   - constrainedMaximumCapacity, highSpeedInterconnectPlacement, singlePlacementGroup, upgradePolicy (default values)

3. New resource: azapi_update_resource.update0 will be created (post-creation update for extensions)

All detected changes match acceptable drift patterns. Proceeding to apply and verify idempotency.

Final Result: Fix successful
