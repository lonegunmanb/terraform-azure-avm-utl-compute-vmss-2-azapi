Test Case: multiple_extensions_template
================================================================================

Still failed after fixing initial issues

Initial Errors and Fixes:

Fix Attempt 1:
- Problem: public_ip_address should be a list, not a single object
- Fix: Wrapped public_ip_address in square brackets
- Result: Fixed

Fix Attempt 2:
- Problem: azapi_update_resource does not support lifecycle block with ignore_changes = [all]
- Fix: Removed the unsupported lifecycle block
- Result: Fixed

Step 3 State Migration Result:

Initial Plan: Showed acceptable drift (removed default values, API version changes)
- Applied changes successfully
- Second plan shows persistent drift: Extensions are showing as additions to the body

Final Error:
After applying the state migration changes, the second plan still shows drift:
- Extensions need to be re-added to the body
- This indicates the extensions are not being managed correctly in the module

The drift shows:
  ~ body = {
      ~ properties = {
          ~ virtualMachineProfile = {
              ~ extensionProfile = {
                  ~ extensions = [
                      + { CustomScript extension details },
                      + { Docker extension details },
                    ]
                }
              }
            }
          }

This is NOT acceptable drift because:
1. Extensions were explicitly configured and should remain in the body
2. The persistent drift indicates a module implementation issue where:
   - Extensions are being removed from the main body
   - azapi_update_resource.update0 applies protected_settings separately
   - But the extensions themselves are not persisting in the body correctly
3. After apply, extensions should be stable but they keep showing as additions

Conclusion:
The module has an implementation error in handling multiple extensions. The extension configuration
is not properly preserved between the main resource and the update resource, causing continuous drift.
This prevents successful state migration as idempotency cannot be achieved.

Root Cause:
The azapi_update_resource.update0 appears to be managing extensions separately, but the lifecycle
block that would have prevented drift (ignore_changes = [all]) is not valid for azapi_update_resource.
The module needs to handle extensions differently to avoid this conflict.
