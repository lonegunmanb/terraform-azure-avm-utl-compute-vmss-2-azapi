module "vmss_replicator" {
  source = "../.."

  name                        = "acctestOVMSS-${random_integer.number.result}"
  location                    = azurerm_resource_group.test.location
  resource_group_id           = azurerm_resource_group.test.id
  platform_fault_domain_count = 1
  zones                       = ["1"]

  os_profile = {}
}

resource "azapi_resource" "this" {
  type                             = module.vmss_replicator.azapi_header.type
  name                             = module.vmss_replicator.azapi_header.name
  location                         = module.vmss_replicator.azapi_header.location
  parent_id                        = module.vmss_replicator.azapi_header.parent_id
  tags                             = module.vmss_replicator.tags
  body                             = module.vmss_replicator.body
  sensitive_body                   = module.vmss_replicator.sensitive_body
  sensitive_body_version           = module.vmss_replicator.sensitive_body_version
  replace_triggers_external_values = module.vmss_replicator.replace_triggers_external_values
  locks                            = module.vmss_replicator.locks

  timeouts {
    create = module.vmss_replicator.timeouts.create
    delete = module.vmss_replicator.timeouts.delete
    read   = module.vmss_replicator.timeouts.read
    update = module.vmss_replicator.timeouts.update
  }
}

resource "azapi_update_resource" "update0" {
  type           = module.vmss_replicator.post_creation_updates[0].azapi_header.type
  name           = module.vmss_replicator.post_creation_updates[0].azapi_header.name
  parent_id      = module.vmss_replicator.post_creation_updates[0].azapi_header.parent_id
  body           = module.vmss_replicator.post_creation_updates[0].body
  sensitive_body = try(module.vmss_replicator.post_creation_updates[0].sensitive_body, null)
}
