# Task #160: timeouts Block - Structure Skeleton

## Summary
Created structure skeleton for the `timeouts` block. This is a Terraform provider-level feature that controls timeout durations for resource operations, NOT part of the Azure API schema.

## Implementation

### Shadow Module Code

**Note:** The `timeouts` block is a Terraform provider construct, not an Azure API property. It does NOT go into the `body` or `sensitive_body`. According to AzAPI provider documentation, timeouts are handled at the resource level in the parent module, not in the shadow module's output. This task creates a PLACEHOLDER ONLY - actual implementation belongs in the parent module's `azapi_resource` block.

```hcl
# NO CODE CHANGES REQUIRED IN SHADOW MODULE
# The timeouts block is handled directly in the parent module's azapi_resource:
# resource "azapi_resource" "this" {
#   timeouts {
#     create = var.timeouts != null ? var.timeouts.create : null
#     delete = var.timeouts != null ? var.timeouts.delete : null
#     read   = var.timeouts != null ? var.timeouts.read : null
#     update = var.timeouts != null ? var.timeouts.update : null
#   }
# }
```

## Provider Schema Verification

From `query_terraform_block_implementation_source_code(entrypoint_name="schema")`:

```go
Timeouts: &pluginsdk.ResourceTimeout{
    Create: pluginsdk.DefaultTimeout(60 * time.Minute),
    Read:   pluginsdk.DefaultTimeout(5 * time.Minute),
    Update: pluginsdk.DefaultTimeout(60 * time.Minute),
    Delete: pluginsdk.DefaultTimeout(60 * time.Minute),
},
```

**Evidence:**
- `timeouts` is defined at the resource level using `Timeouts: &pluginsdk.ResourceTimeout{}`
- Default values: Create=60min, Read=5min, Update=60min, Delete=60min
- This is a meta-block, not a request body property

From Terraform schema query:
```json
"timeouts": {
  "nesting_mode": "single",
  "block": {
    "attributes": {
      "create": {"type": "string", "optional": true},
      "delete": {"type": "string", "optional": true},
      "read": {"type": "string", "optional": true},
      "update": {"type": "string", "optional": true}
    }
  }
}
```

## Timeouts Block Structure

The `timeouts` block has four optional arguments:
- `create` (string, optional) - Timeout for create operations (default: 60 minutes)
- `delete` (string, optional) - Timeout for delete operations (default: 60 minutes)
- `read` (string, optional) - Timeout for read operations (default: 5 minutes)
- `update` (string, optional) - Timeout for update operations (default: 60 minutes)

## Special Handling

**CRITICAL UNDERSTANDING:**

The `timeouts` block is NOT an Azure API property. It's a Terraform SDK feature that controls how long Terraform will wait for Azure API operations to complete. 

**For Shadow Modules:**
- Shadow modules output `body`, `sensitive_body`, `azapi_header`, etc. for Azure API calls
- The `timeouts` block is applied at the `azapi_resource` level in the PARENT module
- Shadow module does NOT and CANNOT control timeouts directly

**Implementation Location:**
The parent module (which consumes this shadow module) applies timeouts like this:
```hcl
resource "azapi_resource" "this" {
  type          = module.shadow.azapi_header.type
  name          = module.shadow.azapi_header.name
  # ... other fields ...
  
  timeouts {
    create = var.orchestrated_virtual_machine_scale_set_timeouts != null ? var.orchestrated_virtual_machine_scale_set_timeouts.create : null
    delete = var.orchestrated_virtual_machine_scale_set_timeouts != null ? var.orchestrated_virtual_machine_scale_set_timeouts.delete : null
    read   = var.orchestrated_virtual_machine_scale_set_timeouts != null ? var.orchestrated_virtual_machine_scale_set_timeouts.read : null
    update = var.orchestrated_virtual_machine_scale_set_timeouts != null ? var.orchestrated_virtual_machine_scale_set_timeouts.update : null
  }
}
```

## Hidden Fields

No hidden fields - this is a Terraform provider meta-block with no Azure API correspondence.

## Child Tasks Ready for Delegation

Since the `timeouts` block is a meta-block that doesn't translate to Azure API calls, the child argument tasks (#161-164) are also meta-level documentation tasks. They don't require implementation in the shadow module's `locals`.

**Child tasks now unblocked:**
- Task #161: `timeouts.create` - Document default timeout value
- Task #162: `timeouts.delete` - Document default timeout value  
- Task #163: `timeouts.read` - Document default timeout value
- Task #164: `timeouts.update` - Document default timeout value

## Edge Case Analysis

1. **Null semantics:** If `timeouts` is null, Terraform uses provider defaults (60m for create/update/delete, 5m for read)
2. **Empty block vs null:** Empty `timeouts {}` block uses provider defaults, same as null
3. **Partial specification:** Can specify only some timeouts (e.g., only `create`), others use defaults
4. **Format:** Timeout strings must be valid Go duration format (e.g., "60m", "1h", "90m")

## Checklist

- ✅ Property in correct location (N/A - not a body property)
- ✅ ForceNew handling (N/A - meta-block doesn't affect resource replacement)
- ✅ All logic exactly replicated (N/A - pass-through to parent module)
- ✅ Validations implemented (Variable already exists with type validation)
- ✅ Hidden fields checked (None - meta-block)
- ✅ Deferred work recorded (N/A)
- ✅ Critical review completed
- ✅ Edge case analysis included
- ✅ Proof created
- ✅ track.md will be updated
- ✅ Self-review: Only created skeleton structure, no inappropriate additions

## Critical Notes

**Why no implementation in shadow module:**

1. The `timeouts` block is NOT part of the Azure REST API request/response
2. Shadow modules transform Terraform config → Azure API calls
3. Timeouts control Terraform's behavior when WAITING for API operations
4. The azapi_resource in the PARENT module (not shadow module) handles timeouts
5. The shadow module's responsibility ends at providing correct `body`, `sensitive_body`, etc.

**Variable already exists:**
The variable `orchestrated_virtual_machine_scale_set_timeouts` already exists in `variables.tf` (lines 1546-1560) with correct structure. No changes needed.

**Parent module responsibility:**
The parent module that instantiates this shadow module will pass the timeouts variable directly to its `azapi_resource` block's `timeouts` argument.

---

## ✅ CHECKER VALIDATION - APPROVED

**Checked by:** Checker Agent
**Date:** 2025-12-11
**Task:** #160 - timeouts

### Validation Results

✅ **Meta-Block Handling:** Correctly identified that `timeouts` is a Terraform provider meta-argument, NOT an Azure API property
✅ **No Implementation Required:** Correctly concluded that shadow module requires no changes for this meta-block
✅ **Variable Existence:** Verified that `orchestrated_virtual_machine_scale_set_timeouts` variable already exists in variables.tf (lines 1546-1560)
✅ **Parent Module Pattern:** Correctly identified that parent module will handle timeouts directly in its azapi_resource block
✅ **Type 3 Skeleton:** While categorized as Type 3 (Block Structure Skeleton), correctly recognized this is an exceptional case where no skeleton code is needed
✅ **Provider Schema:** Correctly documented provider schema with default timeout values (Create=60m, Read=5m, Update=60m, Delete=60m)
✅ **Child Tasks:** Correctly identified child tasks #161-164 as documentation tasks
✅ **Deferred Work:** No deferred work in following.md for this task
✅ **Edge Cases:** Properly analyzed null semantics and format requirements

### Special Case Analysis

This task represents a special case in the migration pattern. The `timeouts` block is a Terraform provider-level meta-argument that:
- Controls operation timeout durations (not Azure API data)
- Already has complete variable definition in variables.tf
- Does not translate to `body`, `sensitive_body`, or any other shadow module output
- Will be consumed directly by parent module's `azapi_resource` block

The executor correctly identified this exceptional pattern and did not create unnecessary code. The proof document adequately explains why no implementation is needed.

**Note on executor.md Final Context:**
The `dynamic "timeouts" { for_each = local.sensitive_body_version; content {} }` pattern shown in executor.md (line 555) is a separate mechanism for change detection tied to sensitive field versions. It is NOT related to the user-facing timeouts variable from Task #160. That dynamic block creates an empty timeouts block that changes when sensitive_body_version changes, forcing Terraform to detect sensitive field updates.

### Compliance Statement

This implementation correctly follows executor.md guidance for this exceptional case. The executor properly recognized that not all Terraform provider blocks translate to Azure API body content, and correctly concluded that no shadow module implementation is required for this meta-argument.

**Status:** APPROVED ✅

---
